---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
  lead?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
}

const { title, description, lead, ogTitle, ogDescription, ogImage } = Astro.props;

const siteUrl = Astro.site || 'https://www.geolonia.com';
const currentPath = Astro.url.pathname;
const currentUrl = new URL(currentPath, siteUrl).toString();

// ページパスに基づいて構造化データを生成
const structuredData: any[] = [];

// プロダクトページの場合、Product構造化データを追加
if (currentPath === '/products/' || currentPath === '/products') {
  // Geolonia Maps
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Geolonia Maps",
    "description": "ウェブサイトやアプリケーションに簡単に組み込める、高性能な地図表示ライブラリです。",
    "brand": {
      "@type": "Brand",
      "name": "Geolonia"
    },
    "offers": {
      "@type": "AggregateOffer",
      "availability": "https://schema.org/InStock",
      "priceCurrency": "JPY",
      "url": new URL("/maps/", siteUrl).toString()
    },
    "category": "地図表示ライブラリ",
    "url": new URL("/maps/", siteUrl).toString()
  });

  // スマートシティ基盤
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "スマートシティのための地理空間データ連携基盤",
    "description": "自治体が保有する地理空間データを統合・管理し、住民サービスの向上や業務効率化を実現するプラットフォームです。",
    "brand": {
      "@type": "Brand",
      "name": "Geolonia"
    },
    "offers": {
      "@type": "AggregateOffer",
      "availability": "https://schema.org/InStock",
      "priceCurrency": "JPY",
      "url": new URL("/geolonia-maps-for-smartcity/", siteUrl).toString()
    },
    "category": "自治体向けプラットフォーム",
    "url": new URL("/geolonia-maps-for-smartcity/", siteUrl).toString()
  });

  // スマートマップ
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "公開型GIS「スマートマップ」",
    "description": "専門知識がなくても、直感的な操作で地図を作成・公開できる公開型GISシステムです。",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "JPY"
    },
    "url": new URL("/smartmap/", siteUrl).toString()
  });

  // 住所正規化ソリューション
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "Service",
    "name": "住所正規化ソリューション",
    "description": "企業や自治体が保有する住所データを統一された形式に変換し、データの品質を向上させるソリューションです。",
    "provider": {
      "@type": "Organization",
      "name": "株式会社Geolonia"
    },
    "serviceType": "住所データ品質向上",
    "areaServed": "JP",
    "url": new URL("/address-normalization/", siteUrl).toString()
  });

  // FAQPage構造化データ
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "商用利用は可能ですか？",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "はい、すべてのプロダクトで商用利用が可能です。プランによってライセンス条件が異なりますので、詳細はお問い合わせください。"
        }
      },
      {
        "@type": "Question",
        "name": "サポートはありますか？",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "はい、メールサポート、技術ドキュメント、コードサンプルなどを提供しています。エンタープライズプランでは専任サポート担当が対応します。"
        }
      },
      {
        "@type": "Question",
        "name": "オンプレミス環境での利用は可能ですか？",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "はい、エンタープライズプランではオンプレミス環境での導入も可能です。詳しくはお問い合わせください。"
        }
      },
      {
        "@type": "Question",
        "name": "データの更新頻度は？",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "地図データは定期的に更新されます。詳細な更新スケジュールについてはお問い合わせください。"
        }
      }
    ]
  });
}

// 会社概要ページの場合、LocalBusiness構造化データを追加
if (currentPath === '/company/' || currentPath === '/company') {
  structuredData.push({
    "@context": "https://schema.org",
    "@type": "Corporation",
    "name": "株式会社Geolonia",
    "alternateName": "Geolonia Inc.",
    "url": siteUrl,
    "foundingDate": "2019",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "東京都",
      "addressCountry": "JP"
    },
    "description": "位置情報テクノロジーとオープンソースを通じて社会の課題を解決する企業",
    "sameAs": [
      "https://twitter.com/geoloniamaps",
      "https://github.com/geolonia"
    ]
  });
}
---

<BaseLayout
  title={`${title} | Geolonia`}
  description={description}
  ogTitle={ogTitle}
  ogDescription={ogDescription}
  ogImage={ogImage}
  structuredData={structuredData}
>
  <div class="page-container">
    <div class="hero-section">
      <div class="container">
        <h1>{title}</h1>
        {lead && <p class="lead">{lead}</p>}
      </div>
    </div>

    <div class="content-section">
      <div class="container markdown-content">
        <slot />
      </div>
    </div>
  </div>
</BaseLayout>

<style is:inline>
  .page-container {
    padding-top: 0;
  }

  .hero-section {
    background: linear-gradient(135deg, #f39813 0%, #eb5722 100%);
    color: white;
    padding: 60px 0;
    margin-bottom: 60px;
  }

  .container {
    max-width: 1140px;
    margin: 0 auto;
    padding: 0 15px;
  }

  .hero-section h1 {
    font-size: 3rem;
    margin: 0 0 1rem 0;
    font-weight: 700;
  }

  .lead {
    font-size: 1.5rem;
    margin: 0;
    opacity: 0.9;
  }

  .content-section {
    padding: 0 0 80px 0;
  }

  .markdown-content :global(h2) {
    color: #f39813;
    font-size: 2rem;
    margin-bottom: 1.5rem;
    margin-top: 2.5rem;
  }

  .markdown-content :global(h2:first-child) {
    margin-top: 0;
  }

  .markdown-content :global(h3) {
    color: #333;
    font-size: 1.5rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .markdown-content :global(h4) {
    color: #333;
    font-size: 1.3rem;
    margin-top: 1.5rem;
    margin-bottom: 0.8rem;
  }

  .markdown-content :global(p) {
    line-height: 1.8;
    margin-bottom: 1rem;
  }

  .markdown-content :global(ul),
  .markdown-content :global(ol) {
    line-height: 1.8;
    margin-bottom: 2rem;
    padding-left: 1.5rem;
  }

  .markdown-content :global(li) {
    margin-bottom: 0.5rem;
  }

  .markdown-content :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
  }

  .markdown-content :global(th),
  .markdown-content :global(td) {
    padding: 1rem;
    border-bottom: 1px solid #e0e0e0;
    text-align: left;
  }

  .markdown-content :global(th) {
    background-color: #f5f5f5;
    font-weight: 700;
  }

  .markdown-content :global(td) {
    line-height: 1.8;
  }

  .markdown-content :global(a) {
    color: #f39813;
    text-decoration: none;
  }

  .markdown-content :global(a:hover) {
    text-decoration: underline;
  }

  .markdown-content :global(hr) {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 3rem 0;
  }

  .markdown-content :global(blockquote) {
    border-left: 4px solid #f39813;
    padding-left: 1.5rem;
    margin: 2rem 0;
    color: #666;
  }

  .markdown-content :global(code) {
    background-color: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
  }

  .markdown-content :global(pre) {
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 5px;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .markdown-content :global(pre code) {
    background-color: transparent;
    padding: 0;
  }

  @media (max-width: 768px) {
    .hero-section h1 {
      font-size: 2rem;
    }

    .lead {
      font-size: 1.2rem;
    }

    .markdown-content :global(h2) {
      font-size: 1.6rem;
    }

    .markdown-content :global(h3) {
      font-size: 1.3rem;
    }

    .markdown-content :global(th),
    .markdown-content :global(td) {
      padding: 0.8rem;
      font-size: 0.9rem;
    }
  }
</style>
